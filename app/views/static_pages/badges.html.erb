<!-- Modal -->
<div id="badgesModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Available Badges</h3>
  </div>
  <div class="modal-body">
    <ul>
      <% Merit::Badge.all.each do |b| %>
        <li>
          <a rel="tooltip" data-placement="right" title="Grants you <%= b.custom_fields[:points] %> points!"><%= image_tag "Badges/#{b.custom_fields[:image]}", size: "28x28" %>
          <%= b.description %></a>
        </li>
      <% end %>
  </ul>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<h1>My recent Badges</h1>
<% if current_user.badges.empty? %>
    <p>No Badges to show</p>
<% else %>
  <hr class="featurette-divider">
  <div class="row">
    <div class="span9">
      <% current_user.trips.each do |trip|%>
        <% trip.badges.each do |badge| %>
          <div class="row">
            <div class="span2">
              <%= image_tag "Badges/#{badge[0].custom_fields[:image]}", size: "70x70" %>
            </div>
            <div class="span7">
              <%= link_to "Granted for a trip on #{Trip.find_by_id(badge[1]).created_at.strftime("%a, %d %B %Y")} at #{Trip.find_by_id(badge[1]).created_at.strftime("%H:%M %P")}", "/trip/show/#{badge[1]}" %>
            </div>
          </div>
          <hr class="featurette-divider">
        <%end%>
      <%end%>
    </div>
    <div class="span3 well">
      <% progress = (current_user.points) / ((Merit::Score.top_scored[0]["sum_points"].to_f)/100) %>

      <%= progress_bar(progress, :color => 'blue', :rounded => true) %> 
      <h4><%= current_user.points %> Points</h4>
      <h2>Earned Badges:</h2>
      <a href="#badgesModal" data-toggle="modal"><i class="icon-plus-sign"></i> Available badges</a>
      <% @badgesList.each do |k, v| %>
        <h4><%= image_tag "Badges/#{Merit::Badge.get(k).custom_fields[:image]}", size: "50x50" %> x<%= v %></h4>
      <%end%>
    </div>
  </div>
<%end%>
      
