- @meta = { :description => "#{@user.login}'s profile on #{configatron.community_name}.", :keywords => "#{@user.login}, #{@user.tags.join(", ") unless @user.tags.nil?}", :robots => configatron.robots_meta_show_content }
- @section = @user.eql?(current_user) ? 'my_profile' : 'users'
- @sidebar_left = true

%div.container-fluid

  %div.span3.sidebar
    %ul.nav.nav-list.well.affix{"data-offset-top" => "30%"}
      %li.nav-header
        = "Jump to ..."
      %li.divider
      %li
        = link_to "Recent Trips", "#trip-list"
      %li
        = link_to "Your Comments", "#comments-list"
      %li
        = link_to "Profile comments", "#received-list" 

  .container
    .row
      = render :partial => "shared/messages"
   
    %div.row-fluid
      %div.span8
        %div.row
          %h1
            = "Statistics Overview"
          %div.row
            %table.table.table-striped
              %thead
                %tr
                  %th
                    %h4.muted
                      = "TOTAL DISTANCE"
                  %th
                    %h4.muted
                      = "RECORDED TRIPS"
                  %th
                    %h4.muted
                      = "TOTAL STANDING TIME"
                  %th
                    %h4.muted
                      = "AVERAGE SPEED"
                  %th
                    %h4.muted
                      = "AVERAGE RPM"
                  %th
                    %h4.muted
                      = "AVERAGE CONSUMPTION"
              %tbody
                %tr.success
                  %td
                    %i.icon-globe
                    = (@mileage).to_s + " Km"
                  %td
                    %i.icon-list
                    = @num_trips.to_s + ""
                  %td
                    %i.icon-pause
                    = ('%.2f' % (@standing_time / 60 / 60)).to_s + " h"
                  %td
                    %i.icon-random
                    = ('%.0f' % @speed).to_s + " Km/h"
                  %td
                    %i.icon-refresh
                    = ('%.0f' % @rpm).to_s + " Rpm"
                  %td
                    %i.icon-tint
                    = ('%.1f' % @consumption).to_s + " l/100km"

        .row
          %p.lead.muted
            = "Ranked " + (@better.length + 1).to_s + ". place with " + @user.points.to_s + " Points"
          %p 
            
          %p
            - progress = '%.0f' % ((@user.points) / ((Merit::Score.top_scored[0]["sum_points"].to_f)/100))
            = progress_bar(progress, :color => 'blue', :rounded => true)
            = icon_link_to 'icon-plus-sign',  "Show badges", "/badges"





        - unless @trips.empty?
          .row
            %h2#trip-list="My recent trips"
            = icon_link_to 'icon-plus-sign',  "Show all trips", "/trip/show?user=#{@user.id}"
            - for i in 1..6 
              .row.well
                %div.span6
                  %div.trip_info
                    = link_to image_tag("/assets/trips/#{@trips[@trips.length-i].id}.png", size: "300x300"), "/trip/show/#{@trips[@trips.length-i].id}"
                %div.span6.listing
                  .row
                    = link_to "#{@trips[@trips.length-i].getTripLength} Kilometers driven on #{@trips[@trips.length-i].measurements.first.recorded_at.strftime("%a, %d %B %Y")} at #{@trips[@trips.length-i].measurements.first.recorded_at.strftime("%H:%M %P")}", "/trip/show/#{@trips[@trips.length-i].id}"
                  %div.row
                    %p
                    %p
                      %ul
                        %li
                          %i.icon-globe
                          = ('%.2f' % @trips[@trips.length-i].getTripLength).to_s + " Km"
                        %li
                          %i.icon-fire
                          = ('%.2f' % @trips[@trips.length-i].measurements.average(:consumption)).to_s + " Liters"
                        %li
                          %i.icon-leaf
                          = ('%.2f' % @trips[@trips.length-i].measurements.average(:co2)).to_s + " g/s"

        - unless @users_comments.empty?
          .row
            %h2#comments-list=:my_recent_comments.l
            - @users_comments.each do |comment|
              .row.well
                .pull-right
                  - if comment.recipient
                    = link_to image_tag(comment.recipient.avatar_photo_url(:thumb), :alt => "#{comment.recipient.login}"), commentable_url(comment), :class => 'thumbnail'
                %h3
                  - if comment.commentable.eql?(comment.recipient)
                    = :to.l + ": #{link_to comment.recipient.login, commentable_url(comment)}".html_safe
                  - else
                    = :on_commentable.l + ": #{link_to comment.commentable_name, commentable_url(comment)} (#{comment.commentable_type.l})".html_safe
                %p= truncate_words( comment.comment, 10, '...').html_safe
        .row
          %h2#received-list=:profile_comments.l
          %a#newest_comment
          = render :partial => 'comments/comment', :collection => @comments
          %span#more_comments_links= more_comments_links(@user)
          %h3=:add_your_comment.l
          = render :partial => 'comments/comment_form', :locals => {:commentable => @user}







      %div.span4
        .pull-right
          =image_tag(@user.avatar_photo_url(:medium))
          %h2= @user.login
          - unless @user.description.blank?
            -box :id => "about_me" do
              %h2
                =:about_me.l
              %p= @user.description.html_safe
            %hr.featurette-divider
          %ul.nav.nav-list
            %li.nav-header="Friends (" + @friend_count.to_s + ")"
            %li=icon_link_to 'icon-plus-sign', :see_all.l, accepted_user_friendships_path(@user)
            %li= link_to "#{:invite_a_friend.l :site => configatron.community_name}", invite_user_path(@user) if @is_current_user
            %li= link_to "#{:view_all_my_friend_requests.l} (#{@pending_friendships_count})", pending_user_friendships_path(@user) if @is_current_user
            %hr.featurette-divider
            - @accepted_friendships.each do |user|
              =render :partial => "users/sidebar_user", :locals => {:user => user}
           
          = render :partial => 'profile_user_info_sidebar', :locals => {:user => @user}




